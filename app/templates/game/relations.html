{% extends "layouts/main.html" %}
{% block title %}Game {{ game.game_id }}{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='vendor/datatables/dataTables.bootstrap4.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/game/relations.css') }}" rel="stylesheet">
{% endblock %}
{% block content %}
<input type="hidden" name="game_id" value="{{ game.game_id }}"</input>
<p>
	<a href="{{ url_for('game_overview', game_id=game.game_id) }}" class="btn btn-light">Overview</a>
	<a href="{{ url_for('game_relations', game_id=game.game_id) }}" class="btn btn-light">Relations</a>
</p>
{% include 'components/game_overview.html' %}
<div class="card mb-3">
	<div class="card-header">
		<i class="fa fa-area-chart"></i> Game {{ game.game_id }}
		<div class="dropdown pull-right">
			<button class="btn btn-secondary btn-sm dropdown-toggle show_button" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Everyone</button>
			<div class="dropdown-menu">
				<button class="dropdown-item show_players">Players</button>
				<button class="dropdown-item show_everyone">Everyone</button>
			</div>
		</div>
	</div>
	<div class="card-body">
		<div id="relations"></div>
	</div>
	<div class="card-footer small text-muted">Updated {{ game.last_fetch }}</div>
</div>
<table class="table table-bordered countrys" width="100%" cellspacing="0">
	<thead>
		<tr>
			<th>Country</th>
			<th>Ruler</th>
			<th>Points</th>
			<th>Percent day</th>
			<th>Percent week</th>
			<th>Last Login</th>
		</tr>
	</thead>
	<tbody>
		{% for player in game.players %}
		<tr {{ 'class=text-muted' if player.defeated }}>
			<td>{{ player.nation_name }}</td>
			{% if player.user is not none  %}
			<td><a href="{{ url_for('user_overview', site_id=player.user.site_id) }}">{{ player.fullname }}</a></td>
			{% else %}
			<td>{{ player.fullname }}</td>
			{% endif %}
			<td class="text-right">{{ player.points() }}</td>
			<td class="text-right text-{{ 'success' if player.last_day_percentage() >= 0 else 'danger' }}">{{ player.last_day_percentage() }}%</td>
			<td class="text-right text-{{ 'success' if player.last_week_percentage() >= 0 else 'danger' }}">{{ player.last_week_percentage() }}%</td>
			<td>{{ player.last_login_formatted }}</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
{% endblock %}
{% block javascript %}
<script type='text/javascript' src="{{ url_for('static', filename='vendor/datatables/jquery.dataTables.min.js') }}"></script>
<script type='text/javascript' src="{{ url_for('static', filename='vendor/datatables/dataTables.bootstrap4.min.js') }}"></script>
<script type='text/javascript' src="{{ url_for('static', filename='vendor/datatables/dataTables.responsive.min.js') }}"></script>
<script type='text/javascript' src="https://d3js.org/d3.v4.min.js"></script>
<script type='text/javascript' src="{{ url_for('static', filename='js/game/relations.js') }}"></script>
{% endblock %}
